---
# Quick playbook to check service status and logs
- name: Check Tail Number Lookup Service Status
  hosts: all
  become: yes
  vars:
    deploy_env: "{{ deploy_env | default('dev') }}"
    service_name: "faa-api-{{ deploy_env }}"
    
  tasks:
    - name: Check service status
      systemd:
        name: "{{ service_name }}"
      register: service_status
      
    - name: Display service status
      debug:
        msg: |
          Service: {{ service_name }}
          Active: {{ service_status.status.ActiveState }}
          SubState: {{ service_status.status.SubState }}
          Enabled: {{ service_status.status.UnitFileState }}
          
    - name: Show recent service logs
      shell: journalctl -u {{ service_name }} -n 50 --no-pager
      register: service_logs
      changed_when: false
      
    - name: Display service logs
      debug:
        var: service_logs.stdout_lines
        
    - name: Check if port is in use
      shell: netstat -tuln | grep -E ':(49080|49081)' || ss -tuln | grep -E ':(49080|49081)' || echo "Port check command not available"
      register: port_check
      changed_when: false
      ignore_errors: yes
      
    - name: Display port status
      debug:
        var: port_check.stdout_lines

